// RansomHub Credential Access - LSASS Dumping
// Detects Mimikatz, ProcDump, and credential dumping techniques
// MITRE: T1003.001 - OS Credential Dumping: LSASS Memory

SecurityEvent
| where EventID in (4688, 4689) // Process creation/termination
| where Process has_any ("procdump", "mimikatz", "pypykatz", "nanodump")
    or CommandLine has_any ("lsass", "sekurlsa", "-ma lsass", "comsvcs.dll MiniDump")
| extend Severity = "Critical", ThreatCategory = "RansomHub-CredentialAccess"
| project TimeGenerated, Computer, Account, Process, CommandLine, ParentProcessName, Severity, ThreatCategory
| join kind=leftouter (
    DeviceFileEvents
    | where FileName endswith ".dmp" or FileName contains "lsass"
    | project DumpFile = FileName, DumpTime = TimeGenerated, DumpDevice = DeviceName
) on $left.Computer == $right.DumpDevice
| summarize Count = count(), FirstSeen = min(TimeGenerated), LastSeen = max(TimeGenerated), 
    ProcessList = make_set(Process), CommandList = make_set(CommandLine) 
    by Computer, Account, Severity, ThreatCategory
